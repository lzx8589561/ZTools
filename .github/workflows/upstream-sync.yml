name: Upstream Sync

permissions:
  contents: write

on:
  schedule:
    - cron: "0 * * * *" # æ¯å°æ—¶è‡ªåŠ¨åŒæ­¥ä¸€æ¬¡
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  sync_latest_from_upstream:
    name: Sync latest commits from upstream repo
    runs-on: ubuntu-latest
    if: ${{ github.event.repository.fork }}

    steps:
      # Step 1: æ£€å‡ºç›®æ ‡ä»“åº“
      - name: Checkout target repo
        uses: actions/checkout@v4

      # Step 2: æ‰§è¡ŒåŒæ­¥æ“ä½œ
      - name: Sync upstream changes
        id: sync
        uses: aormsby/Fork-Sync-With-Upstream-action@v3.4.1
        with:
          upstream_sync_repo: ZToolsCenter/ZTools # ä¸Šæ¸¸ä»“åº“åœ°å€
          upstream_sync_branch: main # ä¸Šæ¸¸åˆ†æ”¯
          target_sync_branch: main # ç›®æ ‡åˆ†æ”¯
          target_repo_token: ${{ secrets.GITHUB_TOKEN }} # è‡ªåŠ¨ç”Ÿæˆçš„ tokenï¼Œæ— éœ€è®¾ç½®

          # è®¾ç½® test_mode ä¸º true å¯ä»¥æµ‹è¯•è€Œä¸å®é™…æ‰§è¡ŒåŒæ­¥
          test_mode: false

      - name: Sync check
        if: failure()
        run: |
          echo "[Error] ç”±äºä¸Šæ¸¸ä»“åº“çš„å·¥ä½œæµæ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼ŒGitHub å·²è‡ªåŠ¨æš‚åœè®¡åˆ’çš„è‡ªåŠ¨æ›´æ–°ã€‚ä½ éœ€è¦æ‰‹åŠ¨åŒæ­¥ä½ çš„ forkã€‚"
          exit 1

      - name: Check for new commits
        if: success()
        run: |
          echo "âœ… åŒæ­¥å®Œæˆï¼"
          if [ "${{ steps.sync.outputs.has_new_commits }}" == "true" ]; then
            echo "ğŸ“¦ å·²åŒæ­¥æ–°çš„æäº¤"
          else
            echo "â„¹ï¸ æ²¡æœ‰æ–°çš„æ›´æ–°"
          fi

